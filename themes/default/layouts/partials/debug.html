<!-- Theme Debug Information -->
<div id="lapis-debug" style="position: fixed; bottom: 0; right: 0; width: 400px; max-height: 300px; background: #1a1a1a; color: #fff; font-family: monospace; font-size: 12px; padding: 10px; border: 1px solid #333; z-index: 9999; overflow-y: auto; display: none;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
    <h3 style="margin: 0; color: #4CAF50;">ðŸ”§ Lapis Debug</h3>
    <button onclick="toggleDebug()" style="background: #333; color: #fff; border: 1px solid #555; padding: 2px 6px; cursor: pointer;">Ã—</button>
  </div>
  
  <div class="debug-section">
    <h4 style="color: #FF9800; margin: 5px 0;">Theme Info</h4>
    <div><strong>Current Theme:</strong> {{ site.theme }}</div>
    <div><strong>Theme Dir:</strong> {{ site.theme_dir }}</div>
    <div><strong>Layouts Dir:</strong> {{ site.layouts_dir }}</div>
    <div><strong>Static Dir:</strong> {{ site.static_dir }}</div>
    <div><strong>Status:</strong> <span style="color: #F44336;">FALLBACK MODE</span></div>
  </div>

  <div class="debug-section">
    <h4 style="color: #2196F3; margin: 5px 0;">Page Info</h4>
    <div><strong>Layout:</strong> {{ page.layout | default: "default" }}</div>
    <div><strong>Kind:</strong> {{ page.kind | default: "page" }}</div>
    <div><strong>URL:</strong> {{ page.url | default: "/" }}</div>
    <div><strong>File Path:</strong> {{ page.file_path | default: "N/A" }}</div>
    <div><strong>Output Path:</strong> {{ page.output_path | default: "N/A" }}</div>
  </div>

  <div class="debug-section">
    <h4 style="color: #9C27B0; margin: 5px 0;">Site Config</h4>
    <div><strong>Title:</strong> {{ site.title }}</div>
    <div><strong>Base URL:</strong> {{ site.base_url }}</div>
    <div><strong>Output Dir:</strong> {{ site.output_dir }}</div>
    <div><strong>Content Dir:</strong> {{ site.content_dir }}</div>
    <div><strong>Debug Mode:</strong> {{ site.debug }}</div>
  </div>

  <div class="debug-section">
    <h4 style="color: #F44336; margin: 5px 0;">Template Context</h4>
    <div><strong>Template Engine:</strong> Lapis v0.4.0</div>
    <div><strong>Theme Manager:</strong> Active</div>
    <div><strong>Partial System:</strong> Active</div>
    <div><strong>Live Reload:</strong> {{ site.live_reload_config.enabled | default: true }}</div>
  </div>

  <div class="debug-section">
    <h4 style="color: #4CAF50; margin: 5px 0;">Assets</h4>
    <div><strong>CSS Includes:</strong> {{ css_includes() | length }} files</div>
    <div><strong>JS Bundles:</strong> {{ site.bundling_config.enabled | default: false }}</div>
    <div><strong>Asset Pipeline:</strong> {{ site.bundling_config.minify | default: false }}</div>
  </div>

  <div class="debug-section">
    <h4 style="color: #FF5722; margin: 5px 0;">Build Info</h4>
    <div><strong>Incremental:</strong> {{ site.build_config.incremental | default: true }}</div>
    <div><strong>Parallel:</strong> {{ site.build_config.parallel | default: true }}</div>
    <div><strong>Cache Dir:</strong> {{ site.build_config.cache_dir | default: ".lapis-cache" }}</div>
    <div><strong>Max Workers:</strong> {{ site.build_config.max_workers | default: 4 }}</div>
  </div>

  <div class="debug-section">
    <h4 style="color: #607D8B; margin: 5px 0;">Content Stats</h4>
    <div><strong>Total Posts:</strong> {{ posts.all.size }}</div>
    <div><strong>Total Pages:</strong> {{ pages.all.size }}</div>
    <div><strong>Tags:</strong> {{ tags.size }}</div>
    <div><strong>Categories:</strong> {{ categories.size }}</div>
  </div>

  <div class="debug-section">
    <h4 style="color: #795548; margin: 5px 0;">Template Resolution</h4>
    <div><strong>Current Template:</strong> {{ page.layout | default: "default" }}</div>
    <div><strong>Template Engine:</strong> Lapis Template Engine</div>
    <div><strong>Partial System:</strong> Active</div>
    <div><strong>Theme Helpers:</strong> Available</div>
  </div>

  <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #333; font-size: 10px; color: #888;">
    <div>Press <kbd style="background: #333; padding: 2px 4px; border-radius: 2px;">Ctrl+D</kbd> to toggle</div>
    <div>Add <kbd style="background: #333; padding: 2px 4px; border-radius: 2px;">?debug=true</kbd> to URL</div>
    <div>Set <kbd style="background: #333; padding: 2px 4px; border-radius: 2px;">debug: true</kbd> in config</div>
  </div>
</div>

<script>
let debugVisible = false;

function toggleDebug() {
  const debugPanel = document.getElementById('lapis-debug');
  if (debugPanel) {
    debugVisible = !debugVisible;
    debugPanel.style.display = debugVisible ? 'block' : 'none';
  }
}

// Keyboard shortcut to toggle debug panel
document.addEventListener('keydown', function(e) {
  if (e.ctrlKey && e.key === 'd') {
    e.preventDefault();
    toggleDebug();
  }
});

// Auto-show debug panel in development mode or with ?debug=true
function shouldShowDebug() {
  const urlParams = new URLSearchParams(window.location.search);
  return window.location.hostname === 'localhost' || 
         window.location.hostname === '127.0.0.1' ||
         urlParams.get('debug') === 'true' ||
         urlParams.get('lapis-debug') === 'true';
}

if (shouldShowDebug()) {
  setTimeout(() => {
    const debugPanel = document.getElementById('lapis-debug');
    if (debugPanel) {
      debugPanel.style.display = 'block';
      debugVisible = true;
    }
  }, 1000);
}
</script>

<style>
#lapis-debug {
  box-shadow: -2px -2px 10px rgba(0,0,0,0.3);
  border-radius: 5px 0 0 0;
}

#lapis-debug .debug-section {
  margin-bottom: 8px;
  padding-bottom: 5px;
  border-bottom: 1px solid #333;
}

#lapis-debug .debug-section:last-child {
  border-bottom: none;
}

#lapis-debug div {
  margin: 2px 0;
  word-break: break-all;
}

#lapis-debug strong {
  color: #fff;
  font-weight: bold;
}

kbd {
  font-family: monospace;
  font-size: 10px;
}
</style>
